{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Observer Telemetry Event",
  "description": "Standard format for telemetry events sent to Medical Mirror Observer",
  "type": "object",
  "required": ["type", "source", "event"],
  "properties": {
    "type": {
      "type": "string",
      "const": "OBSERVER_TELEMETRY",
      "description": "Event type identifier"
    },
    "source": {
      "type": "string",
      "description": "Application name emitting the event",
      "examples": ["athena-scraper", "plaud-ai-uploader", "surgical-command-center"]
    },
    "event": {
      "type": "object",
      "required": ["stage", "action", "timestamp"],
      "properties": {
        "stage": {
          "type": "string",
          "description": "Pipeline stage where event occurred",
          "examples": [
            "interceptor",
            "injector",
            "background",
            "backend",
            "fhir-converter",
            "websocket",
            "frontend",
            "upload",
            "query",
            "ai-query",
            "ingest",
            "data-quality",
            "navigation",
            "form",
            "api",
            "system",
            "plaud-fetch",
            "plaud-export",
            "patient_lookup",
            "procedure_create",
            "voice_capture",
            "transcription",
            "nlp_extraction",
            "field_update",
            "procedure_save",
            "imaging_fetch"
          ]
        },
        "action": {
          "type": "string",
          "description": "What happened at this stage",
          "examples": [
            "capture",
            "forward",
            "process",
            "convert",
            "broadcast",
            "render",
            "error",
            "init",
            "TRANSCRIPT_SUBMITTED",
            "PATIENTS_LOADED",
            "RECORDS_RETRIEVED",
            "RESPONSE_RECEIVED",
            "UPLOAD_COMPLETENESS",
            "TAB_SELECTED",
            "FORM_SUBMITTED",
            "fetch-patient",
            "fetch-failed",
            "fetch-not-found",
            "export-event",
            "export-failed",
            "export-duplicate",
            "SEARCH_INITIATED",
            "SEARCH_COMPLETED",
            "SEARCH_FAILED",
            "PATIENT_SELECTED",
            "PATIENT_NOT_FOUND",
            "CREATE_INITIATED",
            "CREATE_COMPLETED",
            "CREATE_FAILED",
            "PATIENT_LINKED",
            "WS_CONNECTED",
            "WS_DISCONNECTED",
            "RECORDING_STARTED",
            "RECORDING_STOPPED",
            "AUDIO_UPLOADED",
            "TRANSCRIBE_SENT",
            "TRANSCRIBE_COMPLETED",
            "TRANSCRIBE_FAILED",
            "BROADCAST_SENT",
            "EXTRACT_SENT",
            "EXTRACT_COMPLETED",
            "EXTRACT_FAILED",
            "FIELD_MAPPED",
            "FIELD_CHANGED",
            "SYNC_BROADCAST",
            "SYNC_RECEIVED",
            "VALIDATION_ERROR",
            "SAVE_INITIATED",
            "SAVE_COMPLETED",
            "SAVE_FAILED",
            "STATUS_CHANGED",
            "ULTRALINQ_LOGIN_STARTED",
            "ULTRALINQ_LOGIN_COMPLETED",
            "ULTRALINQ_LOGIN_FAILED",
            "STUDIES_SEARCH_STARTED",
            "STUDIES_RETRIEVED",
            "STUDIES_EXTRACTION_FAILED",
            "CLIENT_CONNECTED",
            "CLIENT_REGISTERED",
            "CLIENT_DISCONNECTED",
            "MESSAGE_RECEIVED",
            "MESSAGE_BROADCAST"
          ]
        },
        "success": {
          "type": "boolean",
          "description": "Whether the action succeeded"
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp"
        },
        "duration_ms": {
          "type": "number",
          "description": "Processing time in milliseconds"
        },
        "data": {
          "type": "object",
          "description": "Stage-specific data - flexible schema to support multiple sources",
          "additionalProperties": true
        },
        "correlationId": {
          "type": "string",
          "description": "ID to correlate events across pipeline stages"
        }
      }
    }
  },
  "examples": [
    {
      "type": "OBSERVER_TELEMETRY",
      "source": "athena-scraper",
      "event": {
        "stage": "interceptor",
        "action": "capture",
        "success": true,
        "timestamp": "2024-01-15T10:30:00.000Z",
        "duration_ms": 5,
        "data": {
          "url": "/ax/data?sources=active_medications",
          "method": "GET",
          "status": 200,
          "size": 4521,
          "patientId": "12345678"
        },
        "correlationId": "abc123"
      }
    },
    {
      "type": "OBSERVER_TELEMETRY",
      "source": "plaud-ai-uploader",
      "event": {
        "stage": "upload",
        "action": "TRANSCRIPT_SUBMITTED",
        "success": true,
        "timestamp": "2024-01-15T11:00:00.000Z",
        "duration_ms": 1250,
        "data": {
          "endpoint": "/upload",
          "statusCode": 201,
          "patientId": "patient_123",
          "recordId": "rec_456",
          "confidence": 95,
          "category": "clinical-note"
        },
        "correlationId": "plaud_1705320000_abc123"
      }
    },
    {
      "type": "OBSERVER_TELEMETRY",
      "source": "athena-scraper",
      "event": {
        "stage": "plaud-fetch",
        "action": "fetch-patient",
        "success": true,
        "timestamp": "2024-01-15T12:00:00.000Z",
        "duration_ms": 45,
        "data": {
          "patientId": "12345",
          "eventCount": 47,
          "lastUpdated": "2026-01-05T12:30:00Z",
          "httpStatus": 200
        },
        "correlationId": "athena_12345_abc123"
      }
    },
    {
      "type": "OBSERVER_TELEMETRY",
      "source": "athena-scraper",
      "event": {
        "stage": "plaud-export",
        "action": "export-event",
        "success": true,
        "timestamp": "2024-01-15T12:05:00.000Z",
        "duration_ms": 120,
        "data": {
          "patientId": "12345",
          "eventType": "medication",
          "plaudEventId": "uuid-from-plaud",
          "httpStatus": 200
        },
        "correlationId": "athena_12345_abc123"
      }
    },
    {
      "type": "OBSERVER_TELEMETRY",
      "source": "surgical-command-center",
      "event": {
        "stage": "transcription",
        "action": "TRANSCRIBE_COMPLETED",
        "success": true,
        "timestamp": "2024-01-15T14:30:00.000Z",
        "duration_ms": 450,
        "data": {
          "audioLength": 5.2,
          "textLength": 156,
          "confidence": 0.95,
          "model": "whisper-large-v3"
        },
        "correlationId": "scc_proc_abc123"
      }
    }
  ]
}
